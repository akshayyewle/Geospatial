from datetime import datetime
import urllib.request as req

all_img = []
before_img = []
after_img = []
with open('all.txt','r') as file: # maxar image url info text file location
    all_img = file.readlines()

print(len(all_img))

event_date = datetime(year = 2023,month = 2, day = 7)
quadKeys = ['31133031311','31133031310','31133031301','31133031133','31133031132','31133031131','31133031130','31133031123','31133031121','31133013000','31133012333','31133012332','31133012331','31133012330','31133012323','31133012322','31133012321','31133012320','31133012313','31133012312','31133012311','31133012310','31133012303','31133012302','31133012300','31133012133','31133012132','31133012131','31133012130','31133012122','31133012121','31133012120','31133012113','31133012112','31133012111','31133012110','31133012103','31133012102','31133012101','31133012100','31133013202','31133013200','31133013022','31133013020','31133013002','31133010333','31133010331','31133010330','31133010323','31133010322','31133010321','31133010320','31133010313','31133010312','31133010311','31133010303','31133010302','31133010301','31133010300','31133010233','31133010232','31133010231','31133012011','31133012010','31133012001','31133011222','31133010230','31133010223','31133010221','31133012301','31133012213','31133012211','31133012123','31133113121','31133113120','31133113103','31133113102','31133113101','31133113100','31133113031','31133113013','31133113011','31133102302','31133102300','31133102213','31133102211','31133102210','31133102201','31133102122','31133102121','31133102120','31133102033','31133102032','31133102031','31133102030','31133102023','31133102021','31133031323','31133031321','31133031320','31133031303','31133031230','31133031223','31133031222','31133031221','31133031220','31133031213','31133031211','31133023322','31133023321','31133023320','31133023312','31133023310','31133023303','31133023302','31133023301','31133023300','31133023233','31133023231','31133023213','31133023132','31133023130','31133023123','31133023121','31133023112','31133011011','31133011010','31133003133','31133003132','31133003131','31133031302','31133031300','31133031232','31133031231','31133003130','31131332211','31131332210','31131332033','31131332032','31131312322','31131312320','31131312233','31131312231','31131233233','31131233232','120022103212','120022103210','120022103203','120022103201']
save_path = ''
i = 1

for file in all_img[:1614]:
    try:
        split_file = file.split('ard/')
        dload_file = split_file[1].replace('/', '_').replace('\n', '')
        all_split = dload_file.split('_')
        quad_key = all_split[1]
        img_date_str = all_split[2]
        cat_id = all_split[3].split('-')[0]
        img_date = datetime.strptime(img_date_str, '%Y-%m-%d')
        file_name = f'{quad_key}_{cat_id}_{img_date_str}.tif'
        if quad_key[1:] in quadKeys:
            if img_date >= event_date:
                #save_path = f'C:\User\Dissertation\PostImage\\{file_name}' #Change this path
            else:
                #save_path = f'C:\User\Dissertation\PreImage\\{file_name}' #Change this path
            print(f'Downloading...{dload_file}', i, quad_key)
            #req.urlretrieve(file, save_path) # Uncomment to download
            print(f'Downloaded - {dload_file}', i, quad_key)
        else:
            print(f'{quad_key} not downloaded', i)
    except Exception as ex:
        print(ex)
